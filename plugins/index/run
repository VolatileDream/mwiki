#!/bin/sh

get_files(){
	ls "$1"		|
	grep -E 'html$'
}

get_name(){
	sed 's_[^/]*/__g'	|
	sed 's_.html$__'
}

(
	echo "<h1> Meta </h1><hr>"
	# because tup thinks it is so smart by avoiding to count
	# all of the entries as dependencies for the meta file
	# because we never actually open them for reading. So
	# this forces tup to make them our dependencies. :(
	get_files "$1"	|
	grep -Ev '^~'	|
	get_name	|
	sort -ur	|
	while read line ; do
		cat "$1/$line.mw" > /dev/null
		echo "$line"
	done		|
	sed 's_^.*$_<a href="&.html">&</a>_'
	
	echo
	echo "<hr><h1> Generated Pages </h1><hr>"

	# now find the autogenerated pages, same reasoning for
	# the cat > /dev/null as regular pages
	get_files "$1"	|
	grep -E '^~'	|
	get_name	|
	while read line ; do
		cat "partial/$line" > /dev/null
		echo "$line"
	done		|
	sed 's_^~\(.*\)\.mw$_<a href="~\1.html">\1</a>_'
) |
awk '{ print $0 "<br>" }'
