#!/bin/sh
(
	echo "<h1> Meta </h1><hr>"
	# because tup thinks it's so smart by avoiding to count
	# all of the entries as dependencies for the meta file
	# because we never actually open them for reading. So
	# this forces tup to make them our dependencies. :(
	ls "$1"		|
	grep -E 'mw$'	|
	sed 's_.[^/]/__'|
	sed 's_.mw$__'	|
	sort -u		|
	while read line ; do
		cat "$1/$line.mw" > /dev/null
		echo "$line"
	done		|
	sed 's_^.*$_<a href="&.html">&</a>_'
	
	echo
	echo "<hr><h1> Generated Pages </h1><hr>"

	# now find the autogenerated pages, same reasoning for
	# the cat > /dev/null as regular pages
	ls "partial/"	|
	grep -E '^~'	|
	while read line ; do
		cat "partial/$line" > /dev/null
		echo "$line"
	done		|
	sed 's_^~\(.*\)\.mw$_<a href="~\1.html">\1</a>_'
) |
awk '{ print $0 "<br>" }'
